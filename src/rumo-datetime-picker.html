<link rel="import" href="../../polymer/polymer-element.html">

<link rel="import" href="../../vaadin-ordered-layout/vaadin-vertical-layout.html">
<link rel="import" href="../../vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="../../vaadin-time-picker/vaadin-time-picker.html">

<script src="../../sugar/dist/sugar.min.js"></script>
<script src="../../sugar/dist/locales/de.js"></script>

<dom-module id="rumo-datetime-picker">
  <template>
    <style>
      :host {
        display: block;
      }

      :host([hidden]) {
        display: none !important;
      }

      h3 {
        margin-top: 0;
      }
    </style>
    <div class="container">
      <vaadin-vertical-layout theme="padding">
        <h3 class="block">
          Anfang
        </h3>
        <div class="block">
          <vaadin-date-picker
            id="startDate"
            value="{{startDate}}"></vaadin-date-picker>
        </div>
        <div class="block">
          <vaadin-time-picker value="{{startTime}}"></vaadin-time-picker>
        </div>
      </vaadin-vertical-layout>
      <vaadin-vertical-layout theme="padding">
        <h3 class="block">
          Ende
        </h3>
        <div class="block">
          <vaadin-date-picker
            id="endDate"
            value="{{endDate}}"></vaadin-date-picker>
        </div>
        <div class="block">
          <vaadin-time-picker value="{{endTime}}"></vaadin-time-picker>
        </div>
      </vaadin-vertical-layout>
    </div>
  </template>
  <script>
    /**
     * `rumo-datetime-picker`
     * rumo-datetime-picker is a Web Component providing a date and time selection field.
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class RumoDatetimePicker extends Polymer.Element {
      static get is() {
        return 'rumo-datetime-picker';
      }
      static get properties() {
        return {
          startDate: {
            type: String,
            observer: '_startDateChanged',
          },
          endDate: {
            type: String,
            observer: '_endDateChanged',
          },
          startTime: {
            type: String,
            observer: '_startTimeChanged',
          },
          endTime: {
            type: String,
            observer: '_endTimeChanged',
          },
          startDateTime: {
            type: Number,
            computed: '_computeStartDateTime(startDate, startTime)',
          },
          endDateTime: {
            type: Number,
            computed: '_computeEndDateTime(endDate, endTime)',
          },
        };
      }

      constructor() {
        super();

        Sugar.extend();
      }

      ready() {
        super.ready();

        Sugar.Date.setLocale('de');
        this._i18nCalendar(this.$.startDate);
        this._i18nCalendar(this.$.endDate);
      }

      set startDate(date) {
        this.startDate = date;
      }

      set endDate(date) {
        this.endDate = date;
      }

      set startTime(time) {
        this.startTime = time;
      }

      set endTime(time) {
        this.endTime = time;
      }

      _startDateChanged(newDate, oldDate) {
        if (newDate === '') {
          this.startDate = Sugar.Date.format(
            new Date().rewind('1 day', true),
            '%Y-%m-%d'
          );
        }
      }

      _endDateChanged(newDate, oldDate) {
        if (newDate === '') {
          this.endDate = Sugar.Date.format(new Date(), '%Y-%m-%d');
        }
      }

      _startTimeChanged(newTime, oldTime) {
        if (newTime === '') {
          this.startTime = '00:00';
        }
      }

      _endTimeChanged(newTime, oldTime) {
        if (newTime === '') {
          this.endTime = '23:59';
        }
      }

      _computeStartDateTime(startDate, startTime) {
        console.log(startDate, startTime);
      }

      _computeEndDateTime(endDate, endTime) {
        console.log(endDate, endTime);
      }

      _i18nCalendar(calendar) {
        calendar.i18n = {
          week: 'Woche',
          calendar: 'Kalender',
          clear: 'Leeren',
          today: 'Heute',
          cancel: 'Abbrechen',
          firstDayOfWeek: 1,
          monthNames: 'Januar_Februar_MÃ¤rz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember'.split(
            '_'
          ),
          weekdays: 'Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag'.split(
            '_'
          ),
          weekdaysShort: 'so_mo_di_mi_do_fr_sa'.split('_'),
          formatDate: function(date) {
            return Sugar.Date.format(Sugar.Date.create(date), '{short}');
          },
          formatTitle: function(monthName, fullYear) {
            return monthName + ' ' + fullYear;
          },
          parseDate: function(dateString) {
            const date = Sugar.Date.create(dateString);
            return {
              day: date.getDate(),
              month: date.getMonth(),
              year: date.getFullYear(),
            };
          },
        };
      }
    }

    window.customElements.define(RumoDatetimePicker.is, RumoDatetimePicker);
  </script>
</dom-module>
