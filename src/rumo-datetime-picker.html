<link rel="import" href="../../polymer/polymer-element.html">

<link rel="import" href="../../vaadin-icons/vaadin-icons.html">
<link rel="import" href="../../vaadin-ordered-layout/vaadin-vertical-layout.html">

<link rel="import" href="../../vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="../../vaadin-text-field/vaadin-text-field.html">

<script src="../../sugar/dist/sugar.min.js"></script>
<script src="../../sugar/dist/locales/de.js"></script>

<dom-module id="rumo-datetime-picker">
  <template>
    <style>
      :host {
        display: block;
      }

      :host([hidden]) {
        display: none !important;
      }

      h3 {
        margin-top: 0;
      }
    </style>
    <div class="container">
      <vaadin-vertical-layout theme="padding">
        <h3 class="block">
          Anfang
        </h3>
        <div class="block">
          <vaadin-date-picker
            id="startDate"
            value="{{startDate}}"
            error-message="Please enter a valid date"></vaadin-date-picker>
        </div>
        <div class="block">
          <vaadin-text-field
            value="{{startTime}}"
            pattern="^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
            error-message="Please enter a valid time">
            <iron-icon icon="vaadin:clock" slot="suffix"></iron-icon>
          </vaadin-text-field>
        </div>
      </vaadin-vertical-layout>
      <vaadin-vertical-layout theme="padding">
        <h3 class="block">
          Ende
        </h3>
        <div class="block">
          <vaadin-date-picker
            id="endDate"
            value="{{endDate}}"></vaadin-date-picker>
        </div>
        <div class="block">
          <vaadin-text-field
            value="{{endTime}}"
            pattern="^([01]?[0-9]|2[0-3]):[0-5][0-9]$">
            <iron-icon icon="vaadin:clock" slot="suffix"></iron-icon>
          </vaadin-text-field>
        </div>
      </vaadin-vertical-layout>
    </div>
  </template>
  <script>
    /**
     * `rumo-datetime-picker`
     * rumo-datetime-picker is a Web Component providing a date and time selection field.
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class RumoDatetimePicker extends Polymer.Element {
      static get is() {
        return 'rumo-datetime-picker';
      }
      static get properties() {
        return {
          startDate: {
            type: String,
            value: Sugar.Date.format(new Date(), '%Y-%m-%d'),
          },
          endDate: {
            type: String,
            value: Sugar.Date.format(new Date(), '%Y-%m-%d'),
          },
          startTime: {
            type: String,
            value: '00:00',
          },
          endTime: {
            type: String,
            value: '23:59',
          },
          startDateTime: {
            type: Number,
            computed: '_computeStartDateTime(startDate, startTime)',
          },
          endDateTime: {
            type: Number,
            computed: '_computeEndDateTime(endDate, endTime)',
          },
        };
      }

      constructor() {
        super();

        Sugar.extend();
      }

      ready() {
        super.ready();

        Sugar.Date.setLocale('de');
        this._i18nCalendar(this.$.startDate);
        this._i18nCalendar(this.$.endDate);
      }

      _computeStartDateTime(startDate, startTime) {
        if (!!startDate && !!startTime) {
          const [hours, minutes] = startTime.split(':');
          const date = Sugar.Date.create(startDate)
            .addHours(hours)
            .addMinutes(minutes);

          return date;
        }
      }

      _computeEndDateTime(endDate, endTime) {
        if (!!endDate && !!endTime) {
          const [hours, minutes] = endTime.split(':');
          const date = Sugar.Date.create(endDate)
            .addHours(hours)
            .addMinutes(minutes);

          return date;
        }
      }

      _i18nCalendar(calendar) {
        calendar.i18n = {
          week: 'Woche',
          calendar: 'Kalender',
          clear: 'Leeren',
          today: 'Heute',
          cancel: 'Abbrechen',
          firstDayOfWeek: 1,
          monthNames: 'Januar_Februar_MÃ¤rz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember'.split(
            '_'
          ),
          weekdays: 'Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag'.split(
            '_'
          ),
          weekdaysShort: 'so_mo_di_mi_do_fr_sa'.split('_'),
          formatDate(date) {
            return Sugar.Date.format(Sugar.Date.create(date), '{short}');
          },
          formatTitle(monthName, fullYear) {
            return `${monthName} ${fullYear}`;
          },
          parseDate(dateString) {
            const date = Sugar.Date.create(dateString);
            return {
              day: date.getDate(),
              month: date.getMonth(),
              year: date.getFullYear(),
            };
          },
        };
      }
    }

    window.customElements.define(RumoDatetimePicker.is, RumoDatetimePicker);
  </script>
</dom-module>
