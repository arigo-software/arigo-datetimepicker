<link rel="import" href="../../polymer/polymer-element.html">

<link rel="import" href="../../vaadin-icons/vaadin-icons.html">
<link rel="import" href="../../vaadin-ordered-layout/vaadin-vertical-layout.html">

<link rel="import" href="../../vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="../../vaadin-text-field/vaadin-text-field.html">

<link rel="import" href="bower_components/vaadin-lumo-styles/color.html">
<link rel="import" href="bower_components/vaadin-lumo-styles/sizing.html">
<link rel="import" href="bower_components/vaadin-lumo-styles/spacing.html">
<link rel="import" href="bower_components/vaadin-lumo-styles/style.html">
<link rel="import" href="bower_components/vaadin-lumo-styles/typography.html">

<script src="../../sugar/dist/sugar.min.js"></script>
<script src="../../sugar/dist/locales/de.js"></script>

<dom-module id="rumo-datetime-picker">
  <template>
    <style include="lumo-color lumo-typography"></style>
    <div class="container">
      <vaadin-vertical-layout theme="padding">
        <label class="block">[[label]]</label>
        <div class="block">
          <vaadin-date-picker
            id="date"
            value="{{date}}"
            error-message="Please enter a valid date"></vaadin-date-picker>
        </div>
        <div class="block">
          <vaadin-text-field
            value="{{time}}"
            pattern="^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
            error-message="Please enter a valid time">
            <iron-icon icon="vaadin:clock" slot="suffix"></iron-icon>
          </vaadin-text-field>
        </div>
      </vaadin-vertical-layout>
    </div>
  </template>
  <script>
    /**
     * `rumo-datetime-picker`
     * rumo-datetime-picker is a Web Component providing a date and time selection field.
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class RumoDatetimePicker extends Polymer.Element {
      static get is() {
        return 'rumo-datetime-picker';
      }
      static get properties() {
        return {
          date: {
            type: String,
            value: Sugar.Date.format(new Date(), '%Y-%m-%d'),
          },
          dateTime: {
            type: Number,
            computed: '_computeDateTime(date, time)',
          },
          label: {
            type: String,
            value: '',
            observer: '_labelChanged'
          },
          time: {
            type: String,
            value: '00:00',
          },
        };
      }

      constructor() {
        super();

        Sugar.extend();
      }

      ready() {
        super.ready();

        Sugar.Date.setLocale('de');
        this._i18nCalendar(this.$.date);
      }

      _computeDateTime(date, time) {
        if (!!date && !!time) {
          const [hours, minutes] = time.split(':');
          const dateTime = Sugar.Date.create(date)
            .addHours(hours)
            .addMinutes(minutes);

          return dateTime;
        }
      }

      _labelChanged(label) {
        if (label !== '' && label != null) {
          this.setAttribute('has-label', '');
        } else {
          this.removeAttribute('has-label');
        }
      }

      _i18nCalendar(calendar) {
        calendar.i18n = {
          week: 'Woche',
          calendar: 'Kalender',
          clear: 'Leeren',
          today: 'Heute',
          cancel: 'Abbrechen',
          firstDayOfWeek: 1,
          monthNames: 'Januar_Februar_MÃ¤rz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember'.split(
            '_'
          ),
          weekdays: 'Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag'.split(
            '_'
          ),
          weekdaysShort: 'so_mo_di_mi_do_fr_sa'.split('_'),
          formatDate(date) {
            return Sugar.Date.format(Sugar.Date.create(date), '{short}');
          },
          formatTitle(monthName, fullYear) {
            return `${monthName} ${fullYear}`;
          },
          parseDate(dateString) {
            const date = Sugar.Date.create(dateString);
            return {
              day: date.getDate(),
              month: date.getMonth(),
              year: date.getFullYear(),
            };
          },
        };
      }
    }

    window.customElements.define(RumoDatetimePicker.is, RumoDatetimePicker);
  </script>
</dom-module>
